# 导出功能说明

## 概述
Character Forge V7.1 提供了完整的角色档案导出功能，支持多种格式和照片上传。

## 功能列表

### 1. 照片上传
- **位置**: 右侧预览面板顶部
- **尺寸**: 128x128 像素
- **操作**:
  - 点击虚线框上传照片
  - 支持所有常见图片格式（JPG, PNG, GIF, WebP 等）
  - 点击右上角 X 按钮删除照片
- **存储**: 照片以 Base64 格式存储在内存中

### 2. 导出格式

#### TXT 格式 <i class="fa-solid fa-file-lines"></i>
- **文件名**: `[角色名]_档案_[时间戳].txt`
- **特点**:
  - 纯文本格式，兼容所有文本编辑器
  - 使用 ═══ 边框装饰
  - 属性显示为 ★☆ 星级（如：★★★★☆ 4/5）
  - 包含完整角色信息
- **适用场景**: 快速分享、打印、存档

#### Markdown 格式 <i class="fa-brands fa-markdown"></i>
- **文件名**: `[角色名]_档案_[时间戳].md`
- **特点**:
  - 标准 Markdown 格式
  - 照片以 Base64 嵌入（如果已上传）
  - 使用表格展示属性
  - 支持 GitHub、Notion、Obsidian 等平台
- **适用场景**: 文档管理、团队协作、版本控制

#### PNG 图片 <i class="fa-solid fa-image"></i>
- **文件名**: `[角色名]_档案_[时间戳].png`
- **特点**:
  - 高清截图（2x scale）
  - 包含完整预览卡片样式
  - 包含上传的照片
  - 首次使用自动加载 html2canvas 库
- **适用场景**: 社交媒体分享、视觉展示

#### 复制文本 <i class="fa-solid fa-copy"></i>
- **功能**: 复制到剪贴板
- **格式**: 与 TXT 导出相同
- **提示**: 显示"已复制到剪贴板"
- **适用场景**: 快速粘贴到聊天、邮件

## 导出内容

所有导出格式都包含以下信息：

### 基础信息
- 姓名、职业、性别
- 种族、年龄、身高
- 阵营

### 属性
- 6 项核心属性（力量、敏捷、体质、智力、感知、魅力）
- 星级显示（1-5 星）

### 性格倾向
- 8 项性格维度
- 仅显示偏离中性的特质

### 外貌特征
- 头发（长度、样式、颜色）
- 眼睛（颜色、形状）
- 肤色、脸型
- 特殊标记、配饰
- 体型、服装

### 心理特征
- 恐惧、创伤
- 喜好、厌恶
- 社会评价、物品

### 元数据
- 生成时间（本地时间）

## 技术实现

### 照片处理
```javascript
// 使用 FileReader API 读取图片
const reader = new FileReader();
reader.onload = (e) => {
  characterPhoto = e.target.result; // Base64 格式
};
reader.readAsDataURL(file);
```

### TXT/MD 导出
```javascript
// 使用 Blob API 创建文件
const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
const url = URL.createObjectURL(blob);
// 触发下载
const a = document.createElement('a');
a.href = url;
a.download = filename;
a.click();
```

### PNG 导出
```javascript
// 使用 html2canvas 库截图
const canvas = await html2canvas(element, {
  backgroundColor: '#f8fafc',
  scale: 2,
  logging: false
});
// 转换为 Blob 并下载
canvas.toBlob((blob) => {
  // 下载逻辑
});
```

### 复制到剪贴板
```javascript
// 使用 Clipboard API
navigator.clipboard.writeText(text).then(() => {
  alert('已复制到剪贴板！');
});
```

## 浏览器兼容性

| 功能 | Chrome | Firefox | Safari | Edge |
|------|--------|---------|--------|------|
| 照片上传 | ✅ | ✅ | ✅ | ✅ |
| TXT 导出 | ✅ | ✅ | ✅ | ✅ |
| MD 导出 | ✅ | ✅ | ✅ | ✅ |
| PNG 导出 | ✅ | ✅ | ✅ | ✅ |
| 复制文本 | ✅ | ✅ | ✅ | ✅ |

## 注意事项

1. **照片大小**: 建议使用 < 1MB 的图片，避免文件过大
2. **PNG 导出**: 首次使用需要加载 html2canvas 库（约 200KB）
3. **浏览器权限**: 确保允许下载多个文件
4. **Base64 编码**: Markdown 中的照片会增加文件大小（约 1.33 倍）
5. **隐私保护**: 所有处理都在本地完成，不上传到服务器

## 快捷键

目前不支持快捷键，所有操作通过点击按钮完成。

## 未来计划

- [ ] 支持批量导出
- [ ] 自定义导出模板
- [ ] PDF 格式导出
- [ ] 导出设置（字体、颜色、布局）
- [ ] 快捷键支持

## 相关文件

- `index.html` - 主文件（包含所有导出逻辑）
- `tests/test-export.html` - 导出功能测试页面
- `docs/使用指南.md` - 完整使用指南

## 更新日志

### V7.1 (2024-02-13)
- ✅ 添加照片上传功能
- ✅ 实现 TXT 格式导出
- ✅ 实现 Markdown 格式导出
- ✅ 实现 PNG 图片导出
- ✅ 实现复制到剪贴板
- ✅ 添加 Font Awesome 图标
- ✅ 优化预览面板布局
